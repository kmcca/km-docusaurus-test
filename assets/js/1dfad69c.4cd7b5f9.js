"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[78138],{871:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>p,frontMatter:()=>t,metadata:()=>r,toc:()=>c});var a=i(85893),s=i(11151);const t={title:"Pipeline Scan example for using a baseline file with GitLab",slug:"/r/Pipeline_Scan_Example_for_Using_a_Baseline_File_with_GitLab"},l=void 0,r={id:"guides/integrations/cicd/pipeline_scan/pipeline_scan_gitlab_examples/r_gitlab_pipeline_scan_baseline",title:"Pipeline Scan example for using a baseline file with GitLab",description:"This YAML code example shows how to generate, store, and use a baseline file in a GitLab build pipeline.",source:"@site/docs/guides/04_integrations/03_cicd/09_pipeline_scan/08_pipeline_scan_gitlab_examples/08_r_gitlab_pipeline_scan_baseline.md",sourceDirName:"guides/04_integrations/03_cicd/09_pipeline_scan/08_pipeline_scan_gitlab_examples",slug:"/r/Pipeline_Scan_Example_for_Using_a_Baseline_File_with_GitLab",permalink:"/km-docusaurus-test/r/Pipeline_Scan_Example_for_Using_a_Baseline_File_with_GitLab",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:8,frontMatter:{title:"Pipeline Scan example for using a baseline file with GitLab",slug:"/r/Pipeline_Scan_Example_for_Using_a_Baseline_File_with_GitLab"},sidebar:"tutorialSidebar",previous:{title:"Pipeline Scan example for GitLab and Gradle with automatic vulnerability generation using a custom policy",permalink:"/km-docusaurus-test/r/Pipeline_Scan_Example_for_Using_GitLab_and_Gradle_with_Automatic_Vulnerability_Generation_Using_a_Custom_Policy"},next:{title:"Pipeline Scan example for using Maven with GitLab",permalink:"/km-docusaurus-test/r/Pipeline_Scan_Example_for_Using_Maven_with_GitLab"}},o={},c=[];function _(e){const n={a:"a",code:"code",p:"p",pre:"pre",...(0,s.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.p,{children:"This YAML code example shows how to generate, store, and use a baseline file in a GitLab build pipeline."}),"\n",(0,a.jsxs)(n.p,{children:["The Pipeline Scan evaluates only flaws that differ from those stored in the ",(0,a.jsx)(n.a,{href:"/km-docusaurus-test/r/Using_a_Pipeline_Scan_Baseline_File",children:"baseline file"})," to determine pass or fail criteria. You can use a baseline file to evaluate security risk on only new changes to your application. The Pipeline Scan uses a single pipeline for the build and security scan, then stores the baseline file as an artifact each time a job runs. You can modify this example so that you can run the Pipeline Scan as its own pipeline that another job can trigger. Depending on your build configuration, you may want to store results in a separate globally-accessible location, such as a shared directory."]}),"\n",(0,a.jsxs)(n.p,{children:["The example includes a script that downloads and unzips ",(0,a.jsx)(n.code,{children:"pipeline-scan-LATEST.zip"}),", to ensure you have the latest version, then runs ",(0,a.jsx)(n.code,{children:"pipeline-scan.jar"})," using your ",(0,a.jsx)(n.a,{href:"/km-docusaurus-test/r/c_api_credentials3",children:"API credentials"}),". For improved stability, Veracode recommends that you change these scripts to use the ",(0,a.jsx)(n.a,{href:"https://hub.docker.com/r/veracode/pipeline-scan",children:"Pipeline Scan Docker image"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'image: <image-with-above-requirements>\n\nstages:\n  - build\n  - scan\n  - store\n\nbuild_job:\n  stage: build\n  artifacts:\n    name: ${CI_PROJECT_NAME}_${CI_COMMIT_REF_NAME}_${CI_COMMIT_SHA}_build\n    paths:\n      - build/\n    expire_in: 1 week\n  script: gradle clean build\n\nScan:\n  stage: scan\n  only:\n    - master\n  dependencies:\n    - build_job\n  artifacts:\n    name: ${CI_PROJECT_NAME}_${CI_COMMIT_REF_NAME}_${CI_COMMIT_SHA}_pipeline-results\n    paths:\n      - baseline.json\n    expire_in: 1 week\n    when: always\n  script:\n    - curl -O https://downloads.veracode.com/securityscan/pipeline-scan-LATEST.zip\n    - unzip pipeline-scan-LATEST.zip pipeline-scan.jar\n    - java -jar pipeline-scan.jar\n      --veracode_api_id "${VERACODE_API_ID}"\n      --veracode_api_key "${VERACODE_API_SECRET}"\n      --file "build/libs/sample.jar"\n      --fail_on_severity="Very High, High"\n      --fail_on_cwe="80"\n      --json_output_file="baseline.json"\n      --timeout "${CI_TIMEOUT}"\n      --project_name "${CI_PROJECT_PATH}"\n      --project_url "${CI_REPOSITORY_URL}"\n      --project_ref "${CI_COMMIT_REF_NAME}"\n\nStore Baseline:\n  # Job will only run on master, if requested.\n  # Will restore the above baseline artifact so it can be pulled down in other stages\n  stage: store\n  before_script:\n  only:\n    - master\n  when: manual\n  script:\n    - echo "Storing results.json as baseline.json"\n  artifacts:\n    name: baseline\n    paths:\n      - baseline.json # If you want to keep this longer than the GitLab default - press store in the web UI\n\nBaseline Scan:\n  # Job will run anywhere, except master. Will pull the baseline file and use it in the scan, if available\n  dependencies:\n    - Scan\n  except:\n    - master\n  stage: scan\n  script:\n    - git clean -dfx\n    - "curl -O https://downloads.veracode.com/securityscan/pipeline-scan-LATEST.zip"\n    - unzip pipeline-scan-LATEST.zip pipeline-scan.jar\n    - \'[[ ! -f baseline.json ]] &&  curl --location "$CI_PROJECT_URL/-/jobs/artifacts/$CI_COMMIT_REF_NAME/raw/baseline.json?job=Store%20Baseline" -o baseline.json\'\n    - java -jar pipeline-scan.jar --veracode_api_id "${VERACODE_KEY}" --veracode_api_key "${VERACODE_SECRET}" --file "<file_to_scan>" --project_name "${CI_PROJECT_PATH}" --project_url "${CI_PROJECT_URL}" --project_ref "${CI_COMMIT_REF_NAME}" --baseline_file baseline.json -jf results.json\n'})})]})}function p(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(_,{...e})}):_(e)}},11151:(e,n,i)=>{i.d(n,{Z:()=>r,a:()=>l});var a=i(67294);const s={},t=a.createContext(s);function l(e){const n=a.useContext(t);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),a.createElement(t.Provider,{value:n},e.children)}}}]);