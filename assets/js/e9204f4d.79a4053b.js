"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[99986],{93768:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>t,contentTitle:()=>s,default:()=>p,frontMatter:()=>a,metadata:()=>c,toc:()=>l});var i=r(85893),o=r(11151);const a={title:"Ruby on Rails packaging",slug:"/r/compilation_ruby"},s=void 0,c={id:"guides/packaging/ruby",title:"Ruby on Rails packaging",description:"Your Ruby on Rails applications must meet specific packaging requirements before you can submit them for scanning.",source:"@site/docs/guides/03_packaging/28_ruby.md",sourceDirName:"guides/03_packaging",slug:"/r/compilation_ruby",permalink:"/km-docusaurus-test/r/compilation_ruby",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:28,frontMatter:{title:"Ruby on Rails packaging",slug:"/r/compilation_ruby"},sidebar:"tutorialSidebar",previous:{title:"RPG packaging",permalink:"/km-docusaurus-test/r/compilation_rpg"},next:{title:"Scala packaging",permalink:"/km-docusaurus-test/r/compilation_scala"}},t={},l=[{value:"Supported template formats",id:"supported-template-formats",level:2},{value:"Required files",id:"required-files",level:2},{value:"Veracode packaging gem",id:"veracode-packaging-gem",level:2},{value:"Supported Ruby on Rails versions",id:"supported-ruby-on-rails-versions",level:2},{value:"Packaging guidance",id:"packaging-guidance",level:2},{value:"Package your Ruby on Rails application",id:"package-your-ruby-on-rails-application",level:2},{value:"Using <code>veracode prepare</code>",id:"using-veracode-prepare",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"Your Ruby on Rails applications must meet specific packaging requirements before you can submit them for scanning."}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"/km-docusaurus-test/r/r_supported_table",children:"Supported languages and platforms"})," for instructions for other platforms."]}),"\n",(0,i.jsxs)(n.p,{children:["You can analyze applications using Veracode Static Analysis or Veracode Software Composition Analysis (SCA) upload and scan, if licensed. For SCA agent-based scan requirements, see ",(0,i.jsx)(n.a,{href:"/km-docusaurus-test/r/Using_Veracode_SCA_with_Programming_Languages",children:"Using Veracode SCA with Programming Languages"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"supported-template-formats",children:"Supported template formats"}),"\n",(0,i.jsx)(n.p,{children:"Veracode supports these template formats for analyzing Ruby on Rails applications:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"ERB/Erubis"}),"\n",(0,i.jsx)(n.li,{children:"HAML"}),"\n",(0,i.jsx)(n.li,{children:"Builder"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"required-files",children:"Required files"}),"\n",(0,i.jsx)(n.p,{children:"Veracode requires that you use a custom Veracode RubyGem to package Ruby on Rails applications."}),"\n",(0,i.jsx)(n.h2,{id:"veracode-packaging-gem",children:"Veracode packaging gem"}),"\n",(0,i.jsx)(n.p,{children:"Before uploading your Ruby on Rails code, Veracode requires you to run a special packaging gem. The gem uses features introduced in Ruby 1.9 to translate your application to an archive format that Veracode can scan. The resulting archive contains this information:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Modules and classes, including disassembled instruction sequences for all Ruby methods. Disassembly is not available for methods implemented in C."}),"\n",(0,i.jsx)(n.li,{children:"A log of errors generated by the Veracode gem or other code in your application environment during disassembly."}),"\n",(0,i.jsx)(n.li,{children:"Configuration files for Rails, Bundler, or other common gems."}),"\n",(0,i.jsx)(n.li,{children:"Ruby source and template files."}),"\n",(0,i.jsx)(n.li,{children:"A list of included files."}),"\n",(0,i.jsx)(n.li,{children:"A recursive list of all files in the application directory, including those not contained in the archive."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"To prepare your application for analysis:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Ensure that the application can run."}),"\n",(0,i.jsx)(n.li,{children:"Ensure that you have a functional Rails environment on the system preparing your application."}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["You can test your system for these requirements by running the ",(0,i.jsx)(n.code,{children:"rails server"})," command."]}),"\n",(0,i.jsx)(n.h2,{id:"supported-ruby-on-rails-versions",children:"Supported Ruby on Rails versions"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Language"}),(0,i.jsx)(n.th,{children:"Platform"}),(0,i.jsx)(n.th,{children:"Supported versions"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Ruby"}),(0,i.jsx)(n.td,{children:"Ruby on Rails"}),(0,i.jsx)(n.td,{children:"Ruby 1.9.3, 2.0.x, 2.1.x, 2.3\u20132.7, 3.0, 3.1, 3.2 / Rails 3.x\u20137.0"})]})})]}),"\n",(0,i.jsx)(n.h2,{id:"packaging-guidance",children:"Packaging guidance"}),"\n",(0,i.jsxs)(n.p,{children:["To set up a clean Ruby environment before installing and running the Veracode gem, Veracode recommends you use ",(0,i.jsx)(n.a,{href:"https://rvm.io",children:"RVM"}),". After you install RVM, create the Ruby environment by running the following command sequence:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"rvm install {your version}\nrvm use {your version}@veracode --create\n"})}),"\n",(0,i.jsxs)(n.p,{children:["To install the gem, Veracode recommends that you use ",(0,i.jsx)(n.a,{href:"http://bundler.io",children:"Bundler"}),". Run the following command to update your gem to the latest version:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"railsapp $ bundle update veracode\n"})}),"\n",(0,i.jsxs)(n.p,{children:["As an alternative to Bundler, you can install the gem with the ",(0,i.jsx)(n.code,{children:"install"})," command. After you install RVM and ensure you meet all other application dependencies, run the following command sequence:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"rvm install {your version}\nrvm use {your version}@veracode --create\ngem install veracode\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The packaging gem includes the ",(0,i.jsx)(n.code,{children:"veracode"})," command-line tool that you run in the directory that contains your Rails application. For a list of subcommands and options, run ",(0,i.jsx)(n.code,{children:"veracode"})," or ",(0,i.jsx)(n.code,{children:"veracode help"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["For the ",(0,i.jsx)(n.code,{children:"veracode"})," gem to properly analyze and package your application, you must disable the application setting ",(0,i.jsx)(n.code,{children:"config.cache_classes"}),". You can verify that this setting is disabled in the appropriate environment configuration file. For example, if you are using the ",(0,i.jsx)(n.code,{children:"development"})," environment, ",(0,i.jsx)(n.code,{children:"RAILS_ENV=development veracode prepare"}),", validate that ",(0,i.jsx)(n.code,{children:"config/environments/development.rb"})," contains the line ",(0,i.jsx)(n.code,{children:"config.cache_classes = false"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"/your/ruby/on/railsapp/config/environments/development.rb\nYourApp::Application.configure do\nconfig.cache_classes = false\n\n# Log error messages when you accidentally call methods on nil.\nconfig.whiny_nils = true\n"})}),"\n",(0,i.jsx)(n.h2,{id:"package-your-ruby-on-rails-application",children:"Package your Ruby on Rails application"}),"\n",(0,i.jsxs)(n.p,{children:["You package Ruby on Rails applications with the ",(0,i.jsx)(n.code,{children:"veracode"})," gem."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"To complete this task:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Insert the following dependency in the ",(0,i.jsx)(n.code,{children:"Gemfile"})," of your application:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"#Add the following to /your/ruby/on/railsapp/Gemfile\ngem 'veracode'\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["If you removed the default ",(0,i.jsx)(n.code,{children:"https://rubygems.org/"})," from your Ruby configuration file, you must restore it."]})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["For Ruby versions earlier than 2.4, you must add the following lines to your ",(0,i.jsx)(n.code,{children:"Gemfile"})," to specify a compatible version of ",(0,i.jsx)(n.code,{children:"rubyzip"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"source 'https://rubygems.org'\ngem 'rubyzip', '~>1.0'\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Run the following command sequence to install the application dependencies, Rails, and the ",(0,i.jsx)(n.code,{children:"veracode"})," gem:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"$ cd /your/ruby/on/railsapp\nrailsapp $ rvm use {your version}@veracode\nrailsapp $ bundle install --without development test # or other non-production dependency groups\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Run the following subcommand to create the ZIP archive:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"railsapp $ veracode prepare\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["In the ",(0,i.jsx)(n.code,{children:"tmp"})," folder of the application, find the new file named ",(0,i.jsx)(n.code,{children:"veracode-[application name]-[YYYYmmddHHMMSS timestamp].zip"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Upload the ZIP archive to Veracode."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.h2,{id:"using-veracode-prepare",children:["Using ",(0,i.jsx)(n.code,{children:"veracode prepare"})]}),"\n",(0,i.jsxs)(n.p,{children:["You can create an archive by running the ",(0,i.jsx)(n.code,{children:"veracode prepare"})," command with the following sequence:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"$ cd /{user-folder}/ruby/on/railsapp\nrailsapp $ rvm current      # validates correct ruby and gemset are being used\nrailsapp $ veracode prepare\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"prepare"})," subcommand uses the following syntax:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"veracode prepare\nveracode prepare [-h|--help]\nveracode prepare [-v|--verbose]\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"prepare"})," subcommand creates the archive that you upload to Veracode."]}),"\n",(0,i.jsxs)(n.p,{children:["The gem produces an archive in ZIP format and saves it in the ",(0,i.jsx)(n.code,{children:"tmp"})," folder of the application, for example, ",(0,i.jsx)(n.code,{children:"/my/ruby/on/railsapp/tmp"}),". The ",(0,i.jsx)(n.code,{children:"prepare"})," subcommand creates a file named ",(0,i.jsx)(n.code,{children:"veracode-[application name]-[YYYYmmddHHMMSS timestamp].zip"}),". Upload this file to Veracode."]}),"\n",(0,i.jsxs)(n.p,{children:["If an error occurs while preparing the application, you can view the error log at ",(0,i.jsx)(n.code,{children:"tmp/veracode-[YYYYmmddHHMMSS timestamp]/error.log"}),". Include this file with any support requests you make to Veracode."]})]})}function p(e={}){const{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},11151:(e,n,r)=>{r.d(n,{Z:()=>c,a:()=>s});var i=r(67294);const o={},a=i.createContext(o);function s(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);