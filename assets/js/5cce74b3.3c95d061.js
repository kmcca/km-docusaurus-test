"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[74366],{26634:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>c,toc:()=>a});var s=n(85893),i=n(11151);const r={title:"Example SRM script for OAuth token authorization",slug:"/r/Example_SRM_Script_for_OAuth_Token_Authorization"},o=void 0,c={id:"guides/dynamic_analysis/da_scan_apis/api_scan_config/api_scan_srm_script_examples/api_scan_srm_oath_script_ex",title:"Example SRM script for OAuth token authorization",description:"This example script for Scriptable Request Modification (SRM) uses OAuth to authenticate with a target endpoint during an HTTP request. The script is not limited to OAuth and you can configure it to work with other authorization services.",source:"@site/docs/guides/08_dynamic_analysis/02_da_scan_apis/04_api_scan_config/02_api_scan_srm_script_examples/02_api_scan_srm_oath_script_ex.md",sourceDirName:"guides/08_dynamic_analysis/02_da_scan_apis/04_api_scan_config/02_api_scan_srm_script_examples",slug:"/r/Example_SRM_Script_for_OAuth_Token_Authorization",permalink:"/km-docusaurus-test/r/Example_SRM_Script_for_OAuth_Token_Authorization",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{title:"Example SRM script for OAuth token authorization",slug:"/r/Example_SRM_Script_for_OAuth_Token_Authorization"},sidebar:"tutorialSidebar",previous:{title:"Example SRM script for HMAC signing",permalink:"/km-docusaurus-test/r/Example_SRM_Script_for_HMAC_Signing"},next:{title:"Manage API specifications in the Veracode Platform",permalink:"/km-docusaurus-test/r/Manage_API_Specifications_in_the_Veracode_Platform"}},d={},a=[{value:"<code>HttpClient</code> object function",id:"httpclient-object-function",level:2},{value:"<code>ClientRequest</code> object functions",id:"clientrequest-object-functions",level:2},{value:"<code>ModifiableHttpResponse</code> object functions",id:"modifiablehttpresponse-object-functions",level:2}];function l(e){const t={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(t.p,{children:["This example script for Scriptable Request Modification (SRM) uses ",(0,s.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/OAuth",children:"OAuth"})," to authenticate with a target endpoint during an HTTP request. The script is not limited to OAuth and you can configure it to work with other authorization services."]}),"\n",(0,s.jsxs)(t.p,{children:["Ensure you have read the ",(0,s.jsx)(t.a,{href:"/km-docusaurus-test/r/Example_Script_for_Scriptable_Request_Modification_Authentication",children:"SRM script requirements"}),"."]}),"\n",(0,s.jsx)(t.p,{children:"This script does the following:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Creates and sends a request to an access token URL."}),"\n",(0,s.jsx)(t.li,{children:"Parses the response for the returned bearer token."}),"\n",(0,s.jsx)(t.li,{children:"Adds the bearer token as a header on the original request for authentication."}),"\n",(0,s.jsx)(t.li,{children:"Saves the bearer token in the global scope for reuse on subsequent requests to the target URL."}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:'const clientId = "your-client-ID";\n\nvar bearerToken = null;\n\nfunction run() {\n\n    if (bearerToken === null) {\n        let tokenRequest = createTokenRequest();\n        bearerToken = fetchToken(tokenRequest)\n    }\n\n    updateRequestHeaders(bearerToken);\n}\n\nfunction createTokenRequest() {\n    let username = "your-OAuth-username";\n    let password = "your-OAuth-password";\n    let grantType = "password";\n\n    let tokenRequest = httpClient.createRequest("https://your-api/token");\n    tokenRequest.addHeader("content-type", "application/x-www-form-urlencoded");\n    tokenRequest.setBody("grant_type=" + grantType + "&client_id=" + clientId + "&username=" + username + "&password=" + password);\n    tokenRequest.setMethod("POST");\n\n    return tokenRequest;\n}\n\nfunction fetchToken(tokenRequest) {\n    let response = tokenRequest.send();\n    let message = response.asString();\n    let parsedBearerToken = JSON.parse(message).access_token;\n\n    return parsedBearerToken;\n}\n\nfunction updateRequestHeaders(token) {\n    request.addHeader("authorization", "Bearer " + token);\n    request.addHeader("client_id", clientId);\n}\n\n'})}),"\n",(0,s.jsxs)(t.p,{children:["In this example, the global object named ",(0,s.jsx)(t.code,{children:"httpClient"})," is available to scripts upon each call to the initial ",(0,s.jsx)(t.code,{children:"run()"})," function. The following sections describe the functions and properties of this global object."]}),"\n",(0,s.jsxs)(t.h2,{id:"httpclient-object-function",children:[(0,s.jsx)(t.code,{children:"HttpClient"})," object function"]}),"\n",(0,s.jsxs)(t.p,{children:["This table describes the function and return type for the ",(0,s.jsx)(t.code,{children:"HttpClient"})," object."]}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Function"}),(0,s.jsx)(t.th,{children:"Type"}),(0,s.jsx)(t.th,{children:"Description"})]})}),(0,s.jsx)(t.tbody,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"createRequest(url)"})}),(0,s.jsx)(t.td,{children:"ClientRequest"}),(0,s.jsxs)(t.td,{children:["Returns a new instance of the ",(0,s.jsx)(t.code,{children:"ClientRequest"})," class object that sends the request to the target URL. You specify the target URL as a string for the ",(0,s.jsx)(t.code,{children:"url"})," parameter. To set properties for the ",(0,s.jsx)(t.code,{children:"ClientRequest"})," object, use the functions in the ClientRequest Object Functions table. Ensure you set the properties on the specific instance of the ",(0,s.jsx)(t.code,{children:"ClientRequest"})," object that this function returns."]})]})})]}),"\n",(0,s.jsxs)(t.h2,{id:"clientrequest-object-functions",children:[(0,s.jsx)(t.code,{children:"ClientRequest"})," object functions"]}),"\n",(0,s.jsxs)(t.p,{children:["This table describes the functions and return type for the ",(0,s.jsx)(t.code,{children:"ClientRequest"})," object."]}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Function"}),(0,s.jsx)(t.th,{children:"Type"}),(0,s.jsx)(t.th,{children:"Description"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"addHeader(name, value)"})}),(0,s.jsx)(t.td,{children:"Null"}),(0,s.jsxs)(t.td,{children:["Adds a header to the ",(0,s.jsx)(t.code,{children:"headers"})," array for this request. Both parameter values are strings. If a header with the specified name already exists, this function adds an additional header with the same name."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"setUrl(url)"})}),(0,s.jsx)(t.td,{children:"Null"}),(0,s.jsxs)(t.td,{children:["Sets the URL for this ",(0,s.jsx)(t.code,{children:"ClientRequest"})," as a string. Typically, the URL is already set when the object is instantiated. However, this function can set the URL if the value is null."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"setBody(body)"})}),(0,s.jsx)(t.td,{children:"Null"}),(0,s.jsxs)(t.td,{children:["Sets the body on this ",(0,s.jsx)(t.code,{children:"ClientRequest"})," as a string. Ensure that you add the appropriate ",(0,s.jsx)(t.code,{children:"Content-Type"})," header for the type of body you want to send in the request. Common body types are ",(0,s.jsx)(t.code,{children:"application/x-www-form-urlencoded"})," and ",(0,s.jsx)(t.code,{children:"key-value"}),". For example: ",(0,s.jsx)(t.code,{children:"param1=data1&param2=data2&param3=data3"}),"."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"setMethod(name)"})}),(0,s.jsx)(t.td,{children:"Null"}),(0,s.jsxs)(t.td,{children:["Sets the HTTP method for this ",(0,s.jsx)(t.code,{children:"ClientRequest"})," as a string. The value is usually a GET or POST, but other common values are PUT, PATCH, and DELETE."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"setVersion(version)"})}),(0,s.jsx)(t.td,{children:"Null"}),(0,s.jsxs)(t.td,{children:["Sets the HTTP version for this ",(0,s.jsx)(t.code,{children:"ClientRequest"})," as a string. The default is ",(0,s.jsx)(t.code,{children:"HTTP/1.1"}),"."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"send()"})}),(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"ModifiableHttpResponse"})}),(0,s.jsxs)(t.td,{children:["Returns a ",(0,s.jsx)(t.code,{children:"ModifiableHttpResponse"})," class object, which is a basic implementation of an HTTP response. To get properties for the ",(0,s.jsx)(t.code,{children:"ModifiableHttpResponse"})," object, use the functions in the ModifiableHttpResponse Object Functions table."]})]})]})]}),"\n",(0,s.jsxs)(t.h2,{id:"modifiablehttpresponse-object-functions",children:[(0,s.jsx)(t.code,{children:"ModifiableHttpResponse"})," object functions"]}),"\n",(0,s.jsxs)(t.p,{children:["This table describes the functions and return type for the ",(0,s.jsx)(t.code,{children:"ModifiableHttpResponse"})," object."]}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Function"}),(0,s.jsx)(t.th,{children:"Type"}),(0,s.jsx)(t.th,{children:"Description"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"body()"})}),(0,s.jsx)(t.td,{children:"Byte Array"}),(0,s.jsx)(t.td,{children:"Returns the body message of the response. The body contains a series of bytes encoded in UTF-8, by default, unless the headers specify a different encoding."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"asString()"})}),(0,s.jsx)(t.td,{children:"String"}),(0,s.jsx)(t.td,{children:"Returns the response body message as a string. Veracode recommends that you use this function to simplify parsing the response."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"status()"})}),(0,s.jsx)(t.td,{children:"String"}),(0,s.jsxs)(t.td,{children:["Returns the HTTP response status code as a string. For example, ",(0,s.jsx)(t.code,{children:"200 OK"})," or ",(0,s.jsx)(t.code,{children:"404 NOT FOUND"}),"."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"headers()"})}),(0,s.jsxs)(t.td,{children:["List<",(0,s.jsx)(t.code,{children:"Header"}),">"]}),(0,s.jsx)(t.td,{children:"Returns the response headers as an iterable list."})]})]})]})]})}function h(e={}){const{wrapper:t}={...(0,i.a)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},11151:(e,t,n)=>{n.d(t,{Z:()=>c,a:()=>o});var s=n(67294);const i={},r=s.createContext(i);function o(e){const t=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(r.Provider,{value:t},e.children)}}}]);