"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[28897],{31246:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>u,frontMatter:()=>a,metadata:()=>o,toc:()=>l});var r=i(85893),n=i(11151);const a={author:["Tim Jarrett"],"ft:originID":"api_best_practices",title:"API best practices",slug:"/r/About_Veracode_API_Best_Practices",media_dir:"images/"},s=void 0,o={id:"guides/apis/api_best_practices",title:"API best practices",description:"The Veracode APIs allow you to perform and automate security testing tasks you perform in the Veracode Platform and with Veracode integrations. The best practices in this section help you avoid performance issues for your automations.",source:"@site/docs/guides/14_apis/02_api_best_practices.md",sourceDirName:"guides/14_apis",slug:"/r/About_Veracode_API_Best_Practices",permalink:"/km-docusaurus-test/r/About_Veracode_API_Best_Practices",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{author:["Tim Jarrett"],"ft:originID":"api_best_practices",title:"API best practices",slug:"/r/About_Veracode_API_Best_Practices",media_dir:"images/"},sidebar:"tutorialSidebar",previous:{title:"API rate limiting",permalink:"/km-docusaurus-test/r/About_API_Rate_Limiting"},next:{title:"Enabling HMAC for Veracode APIs",permalink:"/km-docusaurus-test/r/c_enabling_hmac"}},c={},l=[{value:"Using an API service account for automations",id:"using-an-api-service-account-for-automations",level:2},{value:"Ensuring API requests succeed before adding them to a production pipeline",id:"ensuring-api-requests-succeed-before-adding-them-to-a-production-pipeline",level:2},{value:"Safely storing and managing your Veracode credentials",id:"safely-storing-and-managing-your-veracode-credentials",level:2},{value:"Ensuring Veracode credentials are valid",id:"ensuring-veracode-credentials-are-valid",level:2},{value:"Example code for printing credentials expiration warning",id:"example-code-for-printing-credentials-expiration-warning",level:3},{value:"Checking the status of Veracode services",id:"checking-the-status-of-veracode-services",level:2},{value:"Allowing sufficient time between polling calls",id:"allowing-sufficient-time-between-polling-calls",level:2},{value:"Retrying API calls",id:"retrying-api-calls",level:2},{value:"Retrying with rate limits",id:"retrying-with-rate-limits",level:3},{value:"Retrying failed actions to resolve transient network issues",id:"retrying-failed-actions-to-resolve-transient-network-issues",level:3},{value:"Using the Veracode API wrappers for static uploads",id:"using-the-veracode-api-wrappers-for-static-uploads",level:2},{value:"Fetching findings for reports",id:"fetching-findings-for-reports",level:2},{value:"Fetching findings for near real-time information",id:"fetching-findings-for-near-real-time-information",level:2}];function d(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,n.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.a,{href:"/km-docusaurus-test/r/Veracode_APIs",children:"Veracode APIs"})," allow you to perform and automate security testing tasks you perform in the Veracode Platform and with ",(0,r.jsx)(t.a,{href:"/km-docusaurus-test/r/Veracode_Integrations",children:"Veracode integrations"}),". The best practices in this section help you avoid performance issues for your automations."]}),"\n",(0,r.jsx)(t.h2,{id:"using-an-api-service-account-for-automations",children:"Using an API service account for automations"}),"\n",(0,r.jsxs)(t.p,{children:["Veracode strongly recommends that you use an ",(0,r.jsx)(t.a,{href:"/km-docusaurus-test/r/c_about_veracode_accounts",children:"API service account"}),", which is also called an API user, when configuring automations, such as scripts in ",(0,r.jsx)(t.code,{children:"cron"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["For example, if you use a user account and the user assigned to that account leaves your organization, after your Veracode administrator deactivates the account, the user credentials are no longer valid and your automation can no longer authenticate with Veracode. Running automations using an API service account avoids this scenario and also allows a team to get notifications from the Veracode Platform if these events occur. You can create an API service account in the ",(0,r.jsx)(t.a,{href:"/km-docusaurus-test/r/admin_api",children:"Veracode Platform"})," or with the ",(0,r.jsx)(t.a,{href:"/km-docusaurus-test/r/c_identity_create_api",children:"Identity API"}),"."]}),"\n",(0,r.jsx)(t.h2,{id:"ensuring-api-requests-succeed-before-adding-them-to-a-production-pipeline",children:"Ensuring API requests succeed before adding them to a production pipeline"}),"\n",(0,r.jsx)(t.p,{children:"Before adding Veracode APIs to your production pipelines or other build jobs, send a few API requests from a test pipeline to ensure the requests succeed. If the requests fail, ensure your pipeline successfully fails the build."}),"\n",(0,r.jsx)(t.p,{children:"For example, if your pipeline sends a request to start a Static Analysis and the request fails, your team might not see the error and the same request continues to fail during subsequent pipeline runs. If the same job also creates a sandbox with every scan, you could be creating a large number of sandboxes with incomplete scans."}),"\n",(0,r.jsxs)(t.p,{children:["By default, the ",(0,r.jsx)(t.a,{href:"/km-docusaurus-test/r/t_working_with_java_wrapper",children:"Java API wrapper"})," automatically fails a pipeline if a Veracode scan errors. If you write your own scan logic with the Veracode APIs, or if your pipeline automation sends a different API call, you must check for errors and configure your script to return an error code of any value other than ",(0,r.jsx)(t.code,{children:"0"}),"."]}),"\n",(0,r.jsx)(t.h2,{id:"safely-storing-and-managing-your-veracode-credentials",children:"Safely storing and managing your Veracode credentials"}),"\n",(0,r.jsxs)(t.p,{children:["Never store your ",(0,r.jsx)(t.a,{href:"/km-docusaurus-test/r/c_api_credentials3",children:"API credentials"})," in public locations, such as GitHub repositories, in a shell script, or other code, for example. Exposing your credentials to the public invites anyone to access data about the flaws in your software."]}),"\n",(0,r.jsx)(t.p,{children:"After configuring API credentials, Veracode strongly recommends you use one or more of these options to protect them:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Pipeline secrets. See the documentation for your pipeline vendor."}),"\n",(0,r.jsx)(t.li,{children:"Pipeline environment variables. See the documentation for your pipeline vendor."}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.a,{href:"/km-docusaurus-test/r/c_api_credentials3",children:"API credentials file"})," that you store separately from your code and appropriately secure on your host computer."]}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["If your credentials become compromised, you can use the ",(0,r.jsx)(t.a,{href:"/km-docusaurus-test/r/c_identity_revoke_creds",children:"Identity API"})," to quickly revoke them."]}),"\n",(0,r.jsx)(t.h2,{id:"ensuring-veracode-credentials-are-valid",children:"Ensuring Veracode credentials are valid"}),"\n",(0,r.jsxs)(t.p,{children:["You must not let your ",(0,r.jsx)(t.a,{href:"/km-docusaurus-test/r/c_api_credentials3",children:"API credentials"})," expire. By default, API credentials expire 1 year (365 days) after you generate or renew them. If you do not renew credentials before they expire, any automations that use them will fail."]}),"\n",(0,r.jsxs)(t.p,{children:["You can generate API credentials in the ",(0,r.jsx)(t.a,{href:"/km-docusaurus-test/r/c_api_credentials3",children:"Veracode Platform"})," or with the ",(0,r.jsx)(t.a,{href:"/km-docusaurus-test/r/c_identity_gen_creds",children:"Identity API"}),"."]}),"\n",(0,r.jsx)(t.p,{children:"After generating your API credentials:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Make a note of the expiration date and set a reminder to renew the credentials."}),"\n",(0,r.jsx)(t.li,{children:"Check the expiration date in your automation scripts and print a warning to notify your team when the credentials are scheduled to expire."}),"\n",(0,r.jsx)(t.li,{children:"Monitor your email inbox for reminder emails from Veracode. Veracode sends these emails seven days and one day before the credentials expire."}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"example-code-for-printing-credentials-expiration-warning",children:"Example code for printing credentials expiration warning"}),"\n",(0,r.jsx)(t.p,{children:"This Python code example checks for the expiration date for your API credentials and prints a warning to the console if the credentials are close to expiring:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",children:"def creds_expire_days_warning():\n    # the get_creds() method calls \n    # https://api.veracode.com/api/authn/v2/api_credentials\n    creds = api.VeracodeAPI().get_creds()\n    exp = datetime.datetime.strptime(creds['expiration_ts'], \"%Y-%m-%dT%H:%M:%S.%f%z\")\n    delta = exp - datetime.datetime.now().astimezone() #we get a datetime with timezone...\n    if (delta.days < 7):\n        print('These API credentials expire ', creds['expiration_ts'])\n"})}),"\n",(0,r.jsx)(t.h2,{id:"checking-the-status-of-veracode-services",children:"Checking the status of Veracode services"}),"\n",(0,r.jsx)(t.p,{children:"If you need to check the status of various Veracode services, such as the current state of the Veracode Platform or an in-progress scan, Veracode recommends that you use the Veracode Status page or lightweight API calls. Ensure you design these API calls to perform a status check rather than repeatedly calling API endpoints that return more information than you might need. For example:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["To check when scan results are ready, rather than using ",(0,r.jsx)(t.code,{children:"detailedreport.do"}),", call ",(0,r.jsx)(t.code,{children:"getbuildinfo.do"}),"."]}),"\n",(0,r.jsxs)(t.li,{children:["To check for a detailed report of all scan results related to the specified build, only call ",(0,r.jsx)(t.code,{children:"detailedreport.do"}),"."]}),"\n",(0,r.jsxs)(t.li,{children:["To check the status of the Veracode Platform, use the ",(0,r.jsx)(t.a,{href:"https://status.veracode.com/",children:"Veracode Status page"})," or the lightweight ",(0,r.jsx)(t.a,{href:"/km-docusaurus-test/r/c_healthcheck_intro",children:"Healthcheck API"}),"."]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"allowing-sufficient-time-between-polling-calls",children:"Allowing sufficient time between polling calls"}),"\n",(0,r.jsx)(t.p,{children:"You might need to make one API call to initiate a long-running action, then make a second call to check whether that action has completed. For example:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Submitting a static scan, then checking scan status"}),"\n",(0,r.jsx)(t.li,{children:"Requesting a flaw report, then attempting to download it"}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["If your automation checks for updates on these actions every ten seconds, for example, this excessive polling can degrade performance for your account and Veracode might begin to ",(0,r.jsx)(t.a,{href:"/km-docusaurus-test/r/About_API_Rate_Limiting",children:"throttle your API calls"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["Veracode recommends that you wait at least two minutes between API calls that check for the status of a scan or report. For static scans, consider using ",(0,r.jsx)(t.a,{href:"/km-docusaurus-test/r/Pipeline_Scan",children:"Pipeline Scan"}),", which typically executes faster than an equivalent static policy scan or sandbox scan."]}),"\n",(0,r.jsx)(t.h2,{id:"retrying-api-calls",children:"Retrying API calls"}),"\n",(0,r.jsx)(t.p,{children:"It is a best practice to check for errors when making API calls and retry when certain errors are observed. To avoid unnecessary retries, follow the guidance below."}),"\n",(0,r.jsx)(t.h3,{id:"retrying-with-rate-limits",children:"Retrying with rate limits"}),"\n",(0,r.jsxs)(t.p,{children:["Veracode practices ",(0,r.jsx)(t.a,{href:"/km-docusaurus-test/r/About_API_Rate_Limiting",children:"API rate limiting"})," to ensure optimal performance and availability for all users. If a Veracode API call returns an HTTP 429 error code, check the value of the ",(0,r.jsx)(t.code,{children:"retry-after"})," header and retry after that number of seconds has passed."]}),"\n",(0,r.jsx)(t.h3,{id:"retrying-failed-actions-to-resolve-transient-network-issues",children:"Retrying failed actions to resolve transient network issues"}),"\n",(0,r.jsx)(t.p,{children:"When using Veracode APIs in your pipeline, if network problems or other issues cause your pipeline to fail, your application build could be in a bad state. These issues might be unrelated to a network communication failure, particularly when checking for status, between Veracode APIs and Veracode services."}),"\n",(0,r.jsx)(t.p,{children:"To ensure your API integration is more resilient to transient network failures, Veracode recommends that you retry the failed actions no more than five times."}),"\n",(0,r.jsx)(t.h2,{id:"using-the-veracode-api-wrappers-for-static-uploads",children:"Using the Veracode API wrappers for static uploads"}),"\n",(0,r.jsxs)(t.p,{children:["Veracode integrations are built on the ",(0,r.jsx)(t.a,{href:"/km-docusaurus-test/r/c_about_wrappers",children:"API wrappers"}),". These wrappers simplify accessing and using the XML APIs from the command line or functions. You can use them for common workflows, such as uploading application code to a new or existing application profile. For static upload scenarios, the ",(0,r.jsx)(t.a,{href:"/km-docusaurus-test/r/r_uploadandscan",children:(0,r.jsx)(t.code,{children:"uploadandscan"})})," action can replace three or more separate API calls for creating an application profile, creating a sandbox, uploading files and starting a prescan and scan. The ",(0,r.jsx)(t.code,{children:"uploadandscan"})," action also includes guidance mentioned in this section, such as automatic retries on network errors and waiting between status calls."]}),"\n",(0,r.jsx)(t.h2,{id:"fetching-findings-for-reports",children:"Fetching findings for reports"}),"\n",(0,r.jsx)(t.p,{children:"You might need to import Veracode data, such as findings for the applications you are scanning, to an external vulnerability management system, dashboard, or business intelligence (BI) tool. If you have custom integrations that routinely fetch data for several, or all, of your applications, these requests can degrade the performance of your Veracode account."}),"\n",(0,r.jsxs)(t.p,{children:["Veracode recommends using the ",(0,r.jsx)(t.a,{href:"/km-docusaurus-test/r/Reporting_REST_API",children:"Reporting API"})," to fetch data for large volumes of applications for reporting use cases. The Reporting API allows making a single API call to retrieve findings data across many applications, greatly reducing API traffic and avoiding API use patterns that might lead to rate limiting. The Reporting API also allows reporting on closed findings, which is often necessary for reporting use cases."]}),"\n",(0,r.jsx)(t.p,{children:"When using the Reporting API, Veracode recommends the following practices:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["Fetch data for all applications that match your filters. While there is a filter field for ",(0,r.jsx)(t.code,{children:"app_id"}),", Veracode recommends not using this except for debugging purposes. It is more efficient to call the Reporting API for all findings that changed in a certain period than to make multiple calls to the Reporting API for each application in your account."]}),"\n",(0,r.jsxs)(t.li,{children:["Apply other filters to restrict the data retrieved. For instance, if you do not need to report on sandbox scans, set the ",(0,r.jsx)(t.code,{children:"policy_sandbox"}),"\nfilter to ",(0,r.jsx)(t.code,{children:"policy"}),"."]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"fetching-findings-for-near-real-time-information",children:"Fetching findings for near real-time information"}),"\n",(0,r.jsxs)(t.p,{children:["The Reporting API uses Veracode Analytics as its data source, and therefore ",(0,r.jsx)(t.a,{href:"/km-docusaurus-test/r/About_Analytics_Data_Refresh_Times",children:"does not have real-time data"}),". If you need access to near real-time findings data, you can use the ",(0,r.jsx)(t.a,{href:"/km-docusaurus-test/r/c_findings_v2_intro",children:"Findings API"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["To simplify the process of identifying which applications have changed since you last retrieved findings data, you can use the ",(0,r.jsx)(t.code,{children:"last_policy_compliance_check_date"})," property of the ",(0,r.jsx)(t.a,{href:"/km-docusaurus-test/r/Listing_Applications_by_Last_Policy_Evaluation_Date_with_the_Applications_API",children:"Applications API"}),"."]}),"\n",(0,r.jsx)(t.p,{children:"Each time Veracode evaluates the policy for an application, it updates the value for this property based on these events:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Publishing a new policy scan"}),"\n",(0,r.jsx)(t.li,{children:"Approving a mitigation"}),"\n",(0,r.jsx)(t.li,{children:"Assigning a different policy to the application"}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["To get only the applications that have had a policy check since the last time you retrieved data, you can use the ",(0,r.jsx)(t.code,{children:"policy_compliance_checked_after"})," query filter with the Applications API. This allows you to process only changed applications, which significantly decreases total processing time and reduces the number of required API calls."]})]})}function u(e={}){const{wrapper:t}={...(0,n.a)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},11151:(e,t,i)=>{i.d(t,{Z:()=>o,a:()=>s});var r=i(67294);const n={},a=r.createContext(n);function s(e){const t=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:s(e.components),r.createElement(a.Provider,{value:t},e.children)}}}]);